# 09｜性能优化：预加载/预连接、字体加载与首屏体验

本篇以 DevTools Hub 的优化实践为线索，讲解轻量静态站如何稳扎稳打提升“首屏快、交互稳、感知佳”。

## 1. 预加载与预连接

- 预连接（preconnect/dns-prefetch）：提前建立网络握手
- 预加载（preload）：告诉浏览器关键资源优先下载

项目片段（`index.html`）：
```html
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="dns-prefetch" href="//fonts.googleapis.com">
<link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
<link rel="preload" href="/styles.css" as="style">
<link rel="preload" href="/script.js" as="script">
```
Tips：
- 只对真正关键路径使用 `preload`，避免阻塞其他资源
- 对第三方域名用 `preconnect`/`dns-prefetch` 辅助提速

## 2. 字体加载策略

- 延迟加载 CSS：`media="print" onload="this.media='all'"`
- 字体 CSS 延迟：`<link rel="preload" as="style" onload="this.rel='stylesheet'">`
- noscript 兜底，避免 JS 关闭时无样式

体验目标：减少 FOIT（闪烁不可见文本），尽量呈现 FOUT（可见的后切换字体）

## 3. 首屏占位与就绪态

在 CSS/HTML 中提供“首屏占位”与“就绪态切换”：
```html
<style>
  body:not(.ready) .main { opacity:.001 }
  body:not(.ready)::before { /* 居中显示加载文案 */ }
</style>
```
- JS 初始化完成后加 `body.classList.add('ready')`
- 让用户感知“应用在启动”，避免白屏

## 4. 资源体积与零依赖

- 纯原生 JS + 精简 CSS，减少包体
- 图标库走 CDN 延迟加载；必要时替换为 SVG Sprite 或内联子集
- 截图/图片按需加载或压缩（webp/avif）

## 5. 交互与响应

- 输入/滚动等事件节流防抖
- 大数据操作（如 JSON 树）分片渲染或懒加载
- 动画启用 `will-change` 与合成层谨慎使用

## 6. 监测与回归

- 使用 Lighthouse 本地扫描（性能/可访问性/SEO）
- 记录关键指标（TTI/FCP/LCP）并观察 PWA 离线命中效果

---

[上一章：08-国际化与无障碍](./08-国际化与无障碍-i18n切换ARIA与键盘导航.md)  ｜  [下一章：10-部署与 SEO：GitHub Pages、sitemap、Open Graph](./10-部署与SEO-GitHubPages-sitemap-OpenGraph.md)
